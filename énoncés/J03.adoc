= AUTH (entiCation|oriZation)

Notre r√©seau social commence par la cr√©ation d'un compte utilisateur. Nous allons donc mettre en place un syst√®me d'authentification et d'autorisation.

== Objectifs p√©dagogiques

* *Impl√©menter* un syst√®me d'authentification et d'autorisation
* *Impl√©menter* des microservices

== √âtapes

Mettre en place un formulaire d'enregistrement et de connexion pour les utilisateurs.

Cr√©er les microservices d'authentification et d'autorisation.

== Bonus

La correction prendra en compte le bonus. M√™me si tu ne l'impl√©mentes pas, prends le temps de r√©fl√©chir au concept üòâ

*Objectif :* cr√©er un service de s√©curit√©

Actuellement, nous avec un service d'autorisation qui ne fait que v√©rifier le token. Il faudrait lui rajouter la fonctionnalit√© de contr√¥le d'acc√®s. Afin de rester dans la logique de micro service, nous allons utiliser un service de s√©curit√© qui s's'appuiera sur un service de v√©rification du token et un autre service de contr√¥le d'acc√®s.

Ce service de s√©curit√© pourra √™tre appel√© en middleware de toutes les routes du MVC qui ont besoin de s√©curisation.

* Cr√©e un service de s√©curit√© qui ne contient qu'un middleware (pas de route). Ce middleware va "orchestrer" les √©tapes de v√©rification de l'utilisateur. Affiche simplement un message que tu passes bien dans ce service avec un `console.log`.

```typescript
app.use((req: Request, res: Response) => {
    console.log("coucou")
});
```

* Ajoute un middleware au MVC pour appeler ce service de s√©curit√©, pense √† lui passer le token dans le header ainsi que la route et la m√©thode demand√©es par l'utilisateur en param√®tre. Branche le middleware √† une route.
* Branche le service de v√©rification du token au service de s√©curit√©.
* Cr√©e un service de contr√¥le d'acc√®s et branche-le au service de s√©curit√©. Ici, il faudra d√©finir les ACL en fonction de la route que tu souhaites atteindre et de qui fait la requ√™te (role_id extrait du token).

Pour mettre en place un contr√¥le d'acc√®s, il y a une multitude de possibilit√©s. Fait quelques recherches sur internet pour voir ce qui te pla√Æt. L'Access Control Matrix par exemple... Je dis √ßa je dis rien ü§ì Pour une si petite application on va les coder en "dur", mais on pourrait imaginer une base de donn√©es d√©di√©e !

En cadeau, un diagramme de s√©quence pour t'aider √† comprendre le fonctionnement de ce service de s√©curit√© :

image:../assets/security.png[Diagramme de s√©quence de la s√©curit√©]

Des impl√©mentations bien plus complexes existent avec un d√©coupage encore plus fin des microservices. L'essentiel est que tu comprennes la philosophie üòâ